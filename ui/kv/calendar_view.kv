<CalendarScreen>:
    name: "calendar"
    calendar_grid: calendar_grid

    canvas.before:
        Color:
            rgba: 0.98, 0.98, 0.98, 1
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"
        padding: [dp(15), dp(15)]
        spacing: dp(10)

        # ---------- Верхняя панель ----------
        BoxLayout:
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)

            Label:
                text: "Календарь"
                font_size: "24sp"
                bold: True
                color: 0.1, 0.15, 0.25, 1
                halign: "left"
                valign: "middle"
                text_size: self.size

            BoxLayout:
                size_hint_x: 0.7
                spacing: dp(5)

                Button:
                    text: "Сегодня"
                    font_size: "12sp"
                    background_color: 0.2, 0.6, 1, 1
                    background_normal: ""
                    color: 1, 1, 1, 1
                    on_press: root._go_to_today()
                    canvas.before:
                        Color:
                            rgba: 0.2, 0.6, 1, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8)]

                Button:
                    text: "<"
                    font_size: "14sp"
                    background_color: 0.95, 0.95, 0.95, 1
                    background_normal: ""
                    color: 0.3, 0.3, 0.3, 1
                    on_press: root._prev_month()
                    canvas.before:
                        Color:
                            rgba: 0.95, 0.95, 0.95, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8)]

                Button:
                    text: ">"
                    font_size: "14sp"
                    background_color: 0.95, 0.95, 0.95, 1
                    background_normal: ""
                    color: 0.3, 0.3, 0.3, 1
                    on_press: root._next_month()
                    canvas.before:
                        Color:
                            rgba: 0.95, 0.95, 0.95, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8)]

                Button:
                    text: "Назад"
                    font_size: "12sp"
                    background_color: 0.2, 0.6, 1, 1
                    background_normal: ""
                    color: 1, 1, 1, 1
                    on_press: root._go_to_main()
                    canvas.before:
                        Color:
                            rgba: 0.2, 0.6, 1, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8)]

        # ---------- Заголовок месяца ----------
        BoxLayout:
            size_hint_y: None
            height: dp(30)
            padding: [0, dp(5)]

            Label:
                text: "{} {}".format(root.current_month, root.current_year)
                font_size: "18sp"
                bold: True
                color: 0.1, 0.15, 0.25, 1
                halign: "center"
                valign: "middle"
                text_size: self.size

        # ---------- Дни недели ----------
        GridLayout:
            cols: 7
            size_hint_y: None
            height: dp(25)
            spacing: dp(2)

            Label:
                text: "ПН"
                font_size: "12sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ВТ"
                font_size: "12sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "СР"
                font_size: "12sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ЧТ"
                font_size: "12sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ПТ"
                font_size: "12sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "СБ"
                font_size: "12sp"
                bold: True
                color: 0.8, 0.2, 0.2, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ВС"
                font_size: "12sp"
                bold: True
                color: 0.8, 0.2, 0.2, 1
                text_size: self.size
                halign: "center"
                valign: "middle"

        # ---------- Сетка календаря ----------
        GridLayout:
            id: calendar_grid
            cols: 7
            spacing: dp(2)
            size_hint_y: 1.0

        # ---------- Разделительная линия ----------
        BoxLayout:
            size_hint_y: None
            height: dp(1)
            canvas.before:
                Color:
                    rgba: 0.8, 0.8, 0.8, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        # ---------- Панель выбранного дня ----------
        BoxLayout:
            orientation: "vertical"
            size_hint_y: None
            height: dp(120)
            padding: [dp(15), dp(10)]
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(10)]
                Color:
                    rgba: 0.9, 0.9, 0.9, 1
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, dp(10)]
                    width: 1

            # Заголовок выбранного дня
            Label:
                text: "{} {}".format(root.selected_day, root.current_month) if root.selected_day > 0 else "Выберите день"
                font_size: "16sp"
                bold: True
                size_hint_y: 0.3
                color: 0.1, 0.15, 0.25, 1
                text_size: self.size
                halign: "left"
                valign: "middle"

            # Прокручиваемый список задач
            ScrollView:
                size_hint_y: 0.7
                do_scroll_x: False
                bar_color: 0.2, 0.6, 1, 0.7
                bar_width: dp(4)
                bar_inactive_color: 0.2, 0.6, 1, 0.3

                Label:
                    text: root.selected_day_info_text
                    font_size: "14sp"
                    color: 0.4, 0.4, 0.4, 1
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1]
                    halign: "left"
                    valign: "top"
                    markup: True