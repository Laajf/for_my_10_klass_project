<CalendarScreen>:
    name: "calendar"
    calendar_grid: calendar_grid

    canvas.before:
        Color:
            rgba: 0.95, 0.97, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"
        padding: [30, 25]
        spacing: 20

        # ---------- Верхняя панель ----------
        BoxLayout:
            size_hint_y: 0.12
            spacing: 15

            Label:
                text: "Календарь"
                font_size: "30sp"
                bold: True
                color: 0.1, 0.15, 0.25, 1
                halign: "left"
                valign: "middle"
                text_size: self.size

            BoxLayout:
                size_hint_x: 0.7
                spacing: 10

                Button:
                    text: "Сегодня"
                    font_size: "14sp"
                    background_color: 0.15, 0.3, 0.6, 1
                    background_normal: ""
                    color: 1, 1, 1, 1
                    on_press: root._go_to_today()
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.3, 0.6, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [10]

                Button:
                    text: "<"
                    font_size: "16sp"
                    background_color: 0.9, 0.9, 0.9, 1
                    background_normal: ""
                    color: 0.3, 0.3, 0.3, 1
                    on_press: root._prev_month()
                    canvas.before:
                        Color:
                            rgba: 0.9, 0.9, 0.9, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [10]

                Button:
                    text: ">"
                    font_size: "16sp"
                    background_color: 0.9, 0.9, 0.9, 1
                    background_normal: ""
                    color: 0.3, 0.3, 0.3, 1
                    on_press: root._next_month()
                    canvas.before:
                        Color:
                            rgba: 0.9, 0.9, 0.9, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [10]

                Button:
                    text: "Назад"
                    font_size: "14sp"
                    background_color: 0.15, 0.3, 0.6, 1
                    background_normal: ""
                    color: 1, 1, 1, 1
                    on_press: root._go_to_main()
                    canvas.before:
                        Color:
                            rgba: 0.15, 0.3, 0.6, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [10]

        # ---------- Заголовок месяца ----------
        BoxLayout:
            size_hint_y: 0.08
            padding: [0, 5]

            Label:
                text: "{} {}".format(root.current_month, root.current_year)
                font_size: "22sp"
                bold: True
                color: 0.1, 0.15, 0.25, 1
                halign: "center"
                valign: "middle"
                text_size: self.size

        # ---------- Дни недели ----------
        GridLayout:
            cols: 7
            size_hint_y: 0.06
            spacing: 2

            Label:
                text: "ПН"
                font_size: "14sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ВТ"
                font_size: "14sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "СР"
                font_size: "14sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ЧТ"
                font_size: "14sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ПТ"
                font_size: "14sp"
                bold: True
                color: 0.4, 0.4, 0.4, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "СБ"
                font_size: "14sp"
                bold: True
                color: 0.1, 0.3, 0.2, 1
                text_size: self.size
                halign: "center"
                valign: "middle"
            Label:
                text: "ВС"
                font_size: "14sp"
                bold: True
                color: 0.4, 0.25, 0.05, 1
                text_size: self.size
                halign: "center"
                valign: "middle"

        # ---------- Сетка календаря ----------
        GridLayout:
            id: calendar_grid
            cols: 7
            spacing: 2
            size_hint_y: 0.6

        # ---------- Разделительная линия ----------
        BoxLayout:
            size_hint_y: None
            height: 2
            canvas.before:
                Color:
                    rgba: 0, 0, 0, 0.08
                Rectangle:
                    pos: self.pos
                    size: self.size

        # ---------- Панель выбранного дня ----------
        BoxLayout:
            orientation: "vertical"
            size_hint_y: 0.14
            padding: [20, 10]
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [16]
                Color:
                    rgba: 0.8, 0.85, 0.9, 1
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, 16]
                    width: 1

            Label:
                text: "{} {}".format(root.selected_day, root.current_month) if root.selected_day > 0 else "Выберите день"
                font_size: "18sp"
                bold: True
                size_hint_y: 0.4
                color: 0.1, 0.15, 0.25, 1
                text_size: self.size
                halign: "left"
                valign: "middle"

            Label:
                text: "На этот день задачи не запланированы" if root.selected_day > 0 else "Выберите день для просмотра задач"
                font_size: "14sp"
                color: 0.5, 0.5, 0.5, 1
                size_hint_y: 0.6
                text_size: self.size
                halign: "left"
                valign: "top"

<CalendarDay@Button>:
    font_size: '16sp'
    size_hint_y: None
    height: 60
    background_color: 1, 1, 1, 1
    background_normal: ''
    background_down: ''
    color: 0.2, 0.2, 0.2, 1
    bold: False
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
        Color:
            rgba: 0.9, 0.92, 0.95, 1
        Line:
            width: 1
            rectangle: [self.x, self.y, self.width, self.height]